rm(list=ls())
setwd("~/Documents/GitHub/MADDOG_CTB/4B_metadata")
#Import your libraries
library(ggtree)
library(rgdal)
library(ggplot2)
sequence_data<-read.csv("4B_designation/Outputs/sequence_data.csv")
lineage_info<-read.csv("4B_designation/Outputs/relevant_lineages.csv")
new_lineage<-read.csv("4B_designation/Outputs/new_lineages.csv")
tree<-ape::read.tree("4B_designation/Trees/4B_designation_combined_aligned.fasta.contree")
#This combines the new and relevant lineages into one table
lineage_info<-rbind(lineage_info, new_lineage)
#Selecting a list of colours ready to use
lineage_info$colour<-NA
Colours<-c("Reds","Purples","YlOrBr","PuBuGn","YlOrRd","OrRd","PuBu","Pastel1","Greens","Greys",
"GnBu","BuGn","RdPu","Oranges","BuPu","YlGn","PuRd","YlGnBu")
#Extracting the subclades from the lineage (e.g. Cosmopolitan AF1b, Cosmopolitan AF1a)
lineages<-data.frame(lineage = lineage_info$lineage, subclade = NA)
for (i in 1:length(lineages$lineage)) {
lineages$subclade[i]<-strsplit(lineages$lineage[i], "_")[[1]][1]
}
letters <- c("A1", "B1", "C1", "D1", "E1", "F1", "G1", "H1", "I1", "J1", "K1", "L1", "M1", "N1",
"O1", "P1", "Q1", "R1", "S1", "T1", "U1", "V1", "W1", "X1", "Y1", "Z1")
if(length(grep("_", lineage_info$lineage)) != 0) {
if (length(which(lineages$subclade %in% letters)) != 0) {
lineages<-lineages[-c(which(lineages$subclade %in% letters)),]
}
}
#Assigning a colour group to each subclade (e.g. Purple may be AF1b) then giving each lineage a unique colour
# within the subclade colour group (e.g. AF1b_A1 = dark purple, AF1b_A1.1 = light purple)
clades<-unique(lineages$subclade)
lineage<-lineage_info$lineage[-c(grep("_", lineage_info$lineage))]
cols<-RColorBrewer::brewer.pal(9, "Blues")
pal<-colorRampPalette(c(cols))
pal<-rev(pal(length(lineage)))
lineage_info$colour[-c(grep("_", lineage_info$lineage))]<-pal
for (i in 1:length(clades)) {
lineage<-grep(clades[i], lineage_info$lineage)
cols<-RColorBrewer::brewer.pal(3, Colours[i])
pal<-colorRampPalette(c(cols))
pal<-rev(pal(length(lineage)))
lineage_info$colour[(grep(clades[i], lineage_info$lineage))]<-pal
}
attach(sequence_data)
lineage_info<-lineage_info[order(lineage_info$lineage),]
#Making a nice tree with tips colours according to lineage, outlined in grey for aesthetics
plot_tree<-ggtree::ggtree(tree, colour = "grey50", ladderize = T) %<+% sequence_data +
ggtree::geom_tippoint(color="grey50", size=4)+
ggtree::geom_tippoint(ggplot2::aes(color=lineage), size=3)  +
ggtree::theme(plot.title = ggplot2::element_text(size = 40, face = "bold"))+
ggtree::scale_color_manual(values=c(lineage_info$colour)) +
ggtree::theme(legend.position = "none")
#Adding a bar along the side to show lineage colours/positions
genotype<-data.frame(lineage = sequence_data$lineage)
rownames(genotype)<-sequence_data$ID
plot_tree<-ggtree::gheatmap(plot_tree, genotype, offset=-0.01, width=.1, font.size=3, color = NA,
colnames_angle=-45, hjust=0) +
ggtree::scale_fill_manual(values=c(lineage_info$colour), name="lineage")+
ggtree::theme(legend.position = "none")
#View the tree!
plot_tree
#Save the tree!
ggsave("PH_figures/tree.png", plot = plot_tree)
